<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Support Ticketing System</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="logo-section">
                <img id="loginLogo" src="assets/logo.png" alt="Company Logo" class="company-logo-large">
                <h1 id="loginCompanyName" class="company-name" onclick="editCompanyName()">Your Company Name</h1>
            </div>
            <div class="login-form">
                <h2>IT Ticketing System</h2>
                <h3>Login to Support System</h3>
                <form id="loginForm">
                    <input type="text" id="username" placeholder="Username" required>
                    <input type="password" id="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
                <div class="forgot-password">
                    <a href="#" onclick="showPasswordReset()">Forgot Password?</a>
                </div>
                <div id="loginError" class="error-message"></div>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div id="passwordResetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('passwordResetModal')">&times;</span>
            <h3>Reset Password</h3>
            <form id="passwordResetForm">
                <input type="text" id="resetUsername" placeholder="Enter your username" required>
                <input type="email" id="resetEmail" placeholder="Enter your email" required>
                <button type="submit">Send Reset Link</button>
            </form>
            <div id="resetMessage" class="message"></div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="passwordChangeModal" class="modal">
        <div class="modal-content">
            <h3>Change Default Password</h3>
            <p>For security reasons, please change your default password.</p>
            <form id="passwordChangeForm">
                <input type="password" id="newPassword" placeholder="New Password" required>
                <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
                <button type="submit">Change Password</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="page">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <img id="appLogo" src="assets/logo.png" alt="Company Logo" class="company-logo-large">
                <h1 id="appCompanyName" class="company-name-header">Your Company Name</h1>
            </div>
            <div class="user-info">
                <span id="currentUserName"></span>
                <span id="currentUserRole" class="user-role-badge"></span>
            </div>
            <nav class="nav-menu">
                <!-- Common Navigation -->
                <button id="myTicketsBtn" class="nav-btn" data-page="myTickets">My Tickets</button>
                
                <!-- IT Team Navigation -->
                <button id="kanbanBtn" class="nav-btn team-only" data-page="teamKanban">Ticket Board</button>
                
                <!-- Admin Navigation -->
                <button id="dashboardBtn" class="nav-btn admin-only" data-page="adminDashboard">Dashboard</button>
                <button id="kanbanAdminBtn" class="nav-btn admin-only" data-page="adminKanban">Kanban Board</button>
                <button id="userManagementBtn" class="nav-btn admin-only" data-page="userManagement">User Management</button>
                <button id="reportsBtn" class="nav-btn admin-only" data-page="reports">Reports</button>
                <button id="archiveBtn" class="nav-btn admin-only" data-page="archive">Archive</button>
                <button id="settingsBtn" class="nav-btn admin-only" onclick="showSettingsModal()">Settings</button>
                
                <button id="logoutBtn" class="nav-btn logout" onclick="logout()">Logout</button>
            </nav>
        </header>

        <!-- Admin Dashboard Page (Separate Dashboard) -->
        <div id="adminDashboard" class="content-page admin-only">
            <h2>Dashboard Overview</h2>
            <div class="dashboard-filters">
                <select id="dashboardFilter" onchange="filterDashboard()">
                    <option value="department">Department Wise</option>
                    <option value="category">Category Wise</option>
                    <option value="teammember">Team Member Wise</option>
                </select>
                <button onclick="refreshDashboard()" class="btn btn-primary">Refresh</button>
            </div>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>Total Tickets</h3>
                    <span id="totalTickets" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3>Open</h3>
                    <span id="openTickets" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3>In Progress</h3>
                    <span id="inProgressTickets" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3>Resolved</h3>
                    <span id="resolvedTickets" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3>Closed</h3>
                    <span id="closedTickets" class="stat-number">0</span>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="dashboardChart"></canvas>
            </div>
        </div>

        <!-- Admin Kanban Page (Separate Kanban) -->
        <div id="adminKanban" class="content-page admin-only">
            <h2>Admin Kanban Board</h2>
            <div class="kanban-controls">
                <button onclick="refreshKanban()" class="btn btn-primary">Refresh Board</button>
            </div>
            <div class="kanban-board">
                <div class="kanban-column" data-status="Open">
                    <h3>Open <span id="adminOpenCount" class="count-badge">0</span></h3>
                    <div id="adminOpenColumn" class="kanban-tickets"></div>
                </div>
                <div class="kanban-column" data-status="In Progress">
                    <h3>In Progress <span id="adminProgressCount" class="count-badge">0</span></h3>
                    <div id="adminInProgressColumn" class="kanban-tickets"></div>
                </div>
                <div class="kanban-column" data-status="Resolved">
                    <h3>Resolved <span id="adminResolvedCount" class="count-badge">0</span></h3>
                    <div id="adminResolvedColumn" class="kanban-tickets"></div>
                </div>
                <div class="kanban-column" data-status="Closed">
                    <h3>Closed <span id="adminClosedCount" class="count-badge">0</span></h3>
                    <div id="adminClosedColumn" class="kanban-tickets"></div>
                </div>
            </div>
        </div>

        <!-- IT Team Kanban Page -->
        <div id="teamKanban" class="content-page team-only">
            <h2>IT Team - Ticket Board</h2>
            <div class="kanban-info">
                <p><strong>Instructions:</strong> You can drag your assigned tickets from "In Progress" to "Resolved" when you complete the work.</p>
            </div>
            <div class="kanban-controls">
                <button onclick="refreshKanban()" class="btn btn-primary">Refresh Board</button>
                <button onclick="toggleMyTickets()" class="btn btn-secondary" id="filterMyTicketsBtn">Show My Tickets Only</button>
            </div>
            <div class="kanban-board">
                <div class="kanban-column" data-status="Open">
                    <h3>Open <span id="teamOpenCount" class="count-badge">0</span></h3>
                    <div id="teamOpenColumn" class="kanban-tickets"></div>
                </div>
                <div class="kanban-column" data-status="In Progress">
                    <h3>In Progress <span id="teamProgressCount" class="count-badge">0</span></h3>
                    <div id="teamInProgressColumn" class="kanban-tickets"></div>
                </div>
                <div class="kanban-column" data-status="Resolved">
                    <h3>Resolved <span id="teamResolvedCount" class="count-badge">0</span></h3>
                    <div id="teamResolvedColumn" class="kanban-tickets"></div>
                </div>
                <div class="kanban-column" data-status="Closed">
                    <h3>Closed <span id="teamClosedCount" class="count-badge">0</span></h3>
                    <div id="teamClosedColumn" class="kanban-tickets"></div>
                </div>
            </div>
        </div>

        <!-- User Ticket Form -->
        <div id="ticketForm" class="content-page user-only">
            <h2>Submit New Support Ticket</h2>
            <form id="newTicketForm" class="ticket-form">
                <div class="form-group">
                    <label for="ticketType">Type of Ticket:</label>
                    <select id="ticketType" required>
                        <option value="">Select Type</option>
                        <option value="Password reset">Password reset</option>
                        <option value="New User ID Creation">New User ID Creation</option>
                        <option value="De-Activate">De-Activate</option>
                        <option value="Hardware issue">Hardware issue</option>
                        <option value="Software issue">Software issue</option>
                        <option value="New Asset">New Asset</option>
                        <option value="Network issue">Network issue</option>
                        <option value="Printer/Xerox issue">Printer/Xerox issue</option>
                        <option value="Role Change">Role Change</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="severity">Severity:</label>
                    <select id="severity" required>
                        <option value="">Select Severity</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="department">Department:</label>
                    <select id="department" required>
                        <option value="">Select Department</option>
                        <option value="Corporate">Corporate</option>
                        <option value="HR">HR</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Warehouse">Warehouse</option>
                        <option value="QC">QC</option>
                        <option value="QA">QA</option>
                        <option value="Docu Cell">Docu Cell</option>
                        <option value="Admin">Admin</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Security">Security</option>
                        <option value="Stores">Stores</option>
                        <option value="Others">Others</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="supervisor">Supervisor/Reporting Manager Email:</label>
                    <input type="email" id="supervisor" placeholder="supervisor@company.com" required>
                </div>

                <div class="form-group">
                    <label for="location">Location:</label>
                    <input type="text" id="location" placeholder="Office Location" required>
                </div>

                <div class="form-group">
                    <label for="employeeId">Employee ID:</label>
                    <input type="text" id="employeeId" placeholder="Employee ID" required>
                </div>

                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" rows="5" placeholder="Detailed description of the issue" required></textarea>
                </div>

                <div class="form-group">
                    <label for="attachments">Attachments:</label>
                    <input type="file" id="attachments" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                </div>

                <button type="submit" class="submit-btn">Submit Ticket</button>
            </form>
        </div>

        <!-- My Tickets Page (Separate Page) -->
        <div id="myTickets" class="content-page">
            <h2 id="ticketsPageTitle">My Tickets</h2>
            <div class="tickets-filter">
                <select id="ticketStatusFilter" onchange="filterMyTickets()">
                    <option value="">All Tickets</option>
                    <option value="Open">Open</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Resolved">Resolved</option>
                    <option value="Closed">Closed</option>
                </select>
                <button onclick="refreshTicketsList()" class="btn btn-primary">Refresh</button>
            </div>
            <div id="ticketsList" class="tickets-list"></div>
        </div>

        <!-- User Management Page -->
        <div id="userManagement" class="content-page admin-only">
            <h2>User Management</h2>
            <button onclick="showAddUserModal()" class="add-btn">Add New User</button>
            <div class="user-stats">
                <div class="stat-item">Admin Users: <span id="adminCount">0</span></div>
                <div class="stat-item">IT Team Members: <span id="teamCount">0</span></div>
                <div class="stat-item">Regular Users: <span id="regularUserCount">0</span></div>
            </div>
            <div id="usersList" class="users-list"></div>
        </div>

        <!-- Reports Page -->
        <div id="reports" class="content-page admin-only">
            <h2>Ticket Reports</h2>
            <div class="report-filters">
                <input type="date" id="startDate">
                <input type="date" id="endDate">
                <select id="reportType">
                    <option value="all">All Tickets</option>
                    <option value="department">By Department</option>
                    <option value="team">By Team Member</option>
                    <option value="status">By Status</option>
                </select>
                <button onclick="generateReport()">Generate Report</button>
                <button onclick="exportReport()">Export to CSV</button>
            </div>
            <div id="reportTable" class="report-table"></div>
        </div>

        <!-- Archive Page (Admin Only) -->
        <div id="archive" class="content-page admin-only">
            <h2>Archived Tickets</h2>
            <div class="archive-controls">
                <div class="archive-filters">
                    <input type="date" id="archiveStartDate" placeholder="Start Date">
                    <input type="date" id="archiveEndDate" placeholder="End Date">
                    <select id="archiveDepartmentFilter">
                        <option value="">All Departments</option>
                        <option value="Corporate">Corporate</option>
                        <option value="HR">HR</option>
                        <option value="Manufacturing">Manufacturing</option>
                        <option value="Warehouse">Warehouse</option>
                        <option value="QC">QC</option>
                        <option value="QA">QA</option>
                        <option value="Docu Cell">Docu Cell</option>
                        <option value="Admin">Admin</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Security">Security</option>
                        <option value="Stores">Stores</option>
                        <option value="Others">Others</option>
                    </select>
                    <button onclick="filterArchive()" class="btn btn-primary">Filter</button>
                    <button onclick="clearArchiveFilter()" class="btn btn-secondary">Clear Filter</button>
                </div>
                <div class="archive-actions">
                    <button onclick="exportArchive()" class="btn btn-success">Export Archive</button>
                    <button onclick="showBackupModal()" class="btn btn-warning">Backup Data</button>
                    <button onclick="restoreFromBackup()" class="btn btn-danger">Restore Backup</button>
                </div>
            </div>
            <div class="archive-stats">
                <div class="stat-card">
                    <h3>Total Archived</h3>
                    <span id="totalArchived" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3>This Month</h3>
                    <span id="thisMonthArchived" class="stat-number">0</span>
                </div>
                <div class="stat-card">
                    <h3>Storage Used</h3>
                    <span id="storageUsed" class="stat-number">0 MB</span>
                </div>
            </div>
            <div id="archiveList" class="archive-list"></div>
        </div>
    </div>

    <!-- Real-time Status Indicator -->
    <div id="statusIndicator" class="status-indicator">
        <span class="status-dot online"></span>
        <span>Connected</span>
    </div>

    <!-- Modals -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('ticketModal')">&times;</span>
            <div id="ticketDetails"></div>
        </div>
    </div>

    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addUserModal')">&times;</span>
            <h3>Add New User</h3>
            <form id="addUserForm">
                <input type="text" id="newUsername" placeholder="Username" required>
                <input type="email" id="newUserEmail" placeholder="Email" required>
                <select id="newUserDepartment" required>
                    <option value="">Select Department</option>
                    <option value="Corporate">Corporate</option>
                    <option value="HR">HR</option>
                    <option value="Manufacturing">Manufacturing</option>
                    <option value="Warehouse">Warehouse</option>
                    <option value="QC">QC</option>
                    <option value="QA">QA</option>
                    <option value="Docu Cell">Docu Cell</option>
                    <option value="Admin">Admin</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Security">Security</option>
                    <option value="Stores">Stores</option>
                </select>
                <select id="newUserRole" required>
                    <option value="user">Regular User</option>
                    <option value="team">IT Team Member</option>
                    <option value="admin">Administrator</option>
                </select>
                <button type="submit">Add User</button>
            </form>
        </div>
    </div>

    <div id="assignModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('assignModal')">&times;</span>
            <h3>Assign Ticket</h3>
            <form id="assignForm">
                <select id="assignTo" required>
                    <option value="">Select IT Team Member</option>
                </select>
                <textarea id="assignNotes" placeholder="Assignment notes (optional)" rows="3"></textarea>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sendEmailNotification" checked>
                        Send email notification to team member
                    </label>
                </div>
                <button type="submit">Assign Ticket</button>
            </form>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('settingsModal')">&times;</span>
            <h3>System Settings</h3>
            <div class="settings-section">
                <h4>Company Branding</h4>
                <div class="form-group">
                    <label for="logoUpload">Upload Company Logo:</label>
                    <input type="file" id="logoUpload" accept="image/*" onchange="uploadLogo()">
                    <small>Recommended size: 200x80 pixels</small>
                </div>
                <div class="form-group">
                    <label for="companyNameEdit">Company Name:</label>
                    <input type="text" id="companyNameEdit" value="Your Company Name">
                    <button onclick="updateCompanyName()">Update</button>
                </div>
            </div>
        </div>
    </div>

    <div id="backupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('backupModal')">&times;</span>
            <h3>Data Backup & Restore</h3>
            <div class="backup-section">
                <h4>Create Backup</h4>
                <p>Create a timestamped backup of all system data.</p>
                <button onclick="createTimestampedBackup()" class="btn btn-success">Create Backup</button>
            </div>
            <div class="backup-section">
                <h4>Restore from Backup</h4>
                <input type="file" id="backupFile" accept=".json">
                <button onclick="restoreBackupFile()" class="btn btn-warning">Restore Data</button>
            </div>
            <div class="backup-history">
                <h4>Backup History</h4>
                <div id="backupHistoryList"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="data/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/realtime.js"></script>
    <script src="js/app.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/kanban.js"></script>
</body>
</html>
